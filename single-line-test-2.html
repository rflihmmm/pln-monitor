<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <title>Peta Gardu Induk (OpenLayers)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.4.0/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@7.4.0/dist/ol.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="m-0 font-sans">

  <div class="absolute top-2.5 left-2.5 bg-white p-2.5 z-50 shadow-md rounded-md">
    <label class="block mb-1.5"><input type="checkbox" id="toggleGI" checked> Gardu Induk</label>
    <label class="block mb-1.5"><input type="checkbox" id="toggleREC" checked> REC</label>
    <label class="block"><input type="checkbox" id="toggleLBS" checked> LBS</label>
  </div>

  <div id="map" class="w-full h-screen"></div>

  <script>
    const garduInduk = [
      { id: 'GI1', name: 'Gardu Induk A', coords: [106.8, -6.2] }
    ];

    const rec = [
      { id: 'REC1', parent: 'GI1', name: 'REC A1', coords: [106.81, -6.201] },
      { id: 'REC2', parent: 'GI1', name: 'REC A2', coords: [106.82, -6.202] }
    ];

    const lbs = [
      { id: 'LBS1', parent: 'REC1', name: 'LBS A1', coords: [106.811, -6.203] },
      { id: 'LBS2', parent: 'REC2', name: 'LBS A2', coords: [106.821, -6.204] }
    ];

    const fromLonLat = ol.proj.fromLonLat;

    const giSource = new ol.source.Vector();
    const recSource = new ol.source.Vector();
    const lbsSource = new ol.source.Vector();
    const lineSource = new ol.source.Vector();

    function createMarker(coord) {
      return new ol.Feature({
        geometry: new ol.geom.Point(fromLonLat(coord))
      });
    }

    // Tambah data ke layer
    garduInduk.forEach(gi => {
      giSource.addFeature(createMarker(gi.coords));

      rec.forEach(r => {
        if (r.parent === gi.id) {
          recSource.addFeature(createMarker(r.coords));

          lineSource.addFeature(new ol.Feature({
            geometry: new ol.geom.LineString([fromLonLat(gi.coords), fromLonLat(r.coords)])
          }));

          lbs.forEach(l => {
            if (l.parent === r.id) {
              lbsSource.addFeature(createMarker(l.coords));

              lineSource.addFeature(new ol.Feature({
                geometry: new ol.geom.LineString([fromLonLat(r.coords), fromLonLat(l.coords)])
              }));
            }
          });
        }
      });
    });

    const giLayer = new ol.layer.Vector({
      source: giSource,
      style: new ol.style.Style({
        image: new ol.style.Circle({
          radius: 6,
          fill: new ol.style.Fill({ color: 'red' })
        })
      })
    });

    const recLayer = new ol.layer.Vector({
      source: recSource,
      style: new ol.style.Style({
        image: new ol.style.Circle({
          radius: 5,
          fill: new ol.style.Fill({ color: 'blue' })
        })
      })
    });

    const lbsLayer = new ol.layer.Vector({
      source: lbsSource,
      style: new ol.style.Style({
        image: new ol.style.Circle({
          radius: 4,
          fill: new ol.style.Fill({ color: 'green' })
        })
      })
    });

    const lineLayer = new ol.layer.Vector({
      source: lineSource,
      style: new ol.style.Style({
        stroke: new ol.style.Stroke({ color: '#666', width: 2 })
      })
    });

    const map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({ source: new ol.source.OSM() }),
        lineLayer,
        giLayer,
        recLayer,
        lbsLayer
      ],
      view: new ol.View({
        center: fromLonLat([106.81, -6.202]),
        zoom: 14
      })
    });

    document.getElementById('toggleGI').addEventListener('change', (e) => {
      giLayer.setVisible(e.target.checked);
    });

    document.getElementById('toggleREC').addEventListener('change', (e) => {
      recLayer.setVisible(e.target.checked);
    });

    document.getElementById('toggleLBS').addEventListener('change', (e) => {
      lbsLayer.setVisible(e.target.checked);
    });
  </script>

</body>

</html>